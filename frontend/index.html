<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lohnsteuerrechner 2025</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .nav-tabs .nav-link {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Lohnsteuerrechner 2025</h1>
        <form id="tax-form">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general"
                        type="button" role="tab" aria-controls="general" aria-selected="true">Allgemein</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="allowances-tab" data-bs-toggle="tab" data-bs-target="#allowances"
                        type="button" role="tab" aria-controls="allowances"
                        aria-selected="false">Freibeträge/Hinzurechnungen</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="special-payments-tab" data-bs-toggle="tab"
                        data-bs-target="#special-payments" type="button" role="tab" aria-controls="special-payments"
                        aria-selected="false">Sonstige Bezüge</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pension-tab" data-bs-toggle="tab" data-bs-target="#pension"
                        type="button" role="tab" aria-controls="pension"
                        aria-selected="false">Versorgungsbezüge</button>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="RE4" class="form-label">Stpfl. Arbeitslohn für den
                                    Lohnzahlungszeitraum</label>
                                <input type="number" step="0.01" class="form-control" id="RE4" required>
                            </div>
                            <div class="mb-3">
                                <label for="STKL" class="form-label">Steuerklasse</label>
                                <select class="form-select" id="STKL" required>
                                    <option value="1">I</option>
                                    <option value="2">II</option>
                                    <option value="3">III</option>
                                    <option value="4">IV</option>
                                    <option value="5">V</option>
                                    <option value="6">VI</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="LZZ" class="form-label">Lohnzahlungszeitraum</label>
                                <select class="form-select" id="LZZ" required>
                                    <option value="1">Jahr</option>
                                    <option value="2" selected>Monat</option>
                                    <option value="3">Woche</option>
                                    <option value="4">Tag</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="ZKF" class="form-label">Zahl der Freibeträge für Kinder</label>
                                <input type="number" step="0.5" class="form-control" id="ZKF" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="R" class="form-label">Religionsgemeinschaft</label>
                                <select class="form-select" id="R">
                                    <option value="0" selected>Keine</option>
                                    <option value="1">Evangelisch/Katholisch (9%)</option>
                                    <option value="2">Andere (8%)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="KVZ" class="form-label">Kassenindividueller Zusatzbeitragssatz in %</label>
                                <input type="number" step="0.01" class="form-control" id="KVZ" value="1.7">
                            </div>
                            <div class="mb-3">
                                <label for="PKV" class="form-label">Krankenversicherung</label>
                                <select class="form-select" id="PKV">
                                    <option value="0" selected>gesetzlich</option>
                                    <option value="1">privat ohne AG-Zuschuss</option>
                                    <option value="2">privat mit AG-Zuschuss</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="PKPV" class="form-label">Private Kranken- / Pflegeversicherung
                                    Monatsbetrag</label>
                                <input type="number" step="0.01" class="form-control" id="PKPV" value="0">
                            </div>
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="PVS">
                                <label class="form-check-label" for="PVS">Besonderheiten in Sachsen</label>
                            </div>
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="PVZ">
                                <label class="form-check-label" for="PVZ">Zuschlag zur sozialen
                                    Pflegeversicherung</label>
                            </div>
                            <div class="mb-3">
                                <label for="PVA" class="form-label">Beitragsabschläge in der sozialen
                                    Pflegeversicherung</label>
                                <input type="number" step="0.01" class="form-control" id="PVA" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="KRV" class="form-label">Gesetzliche Rentenversicherung</label>
                                <select class="form-select" id="KRV">
                                    <option value="0" selected>Ja</option>
                                    <option value="1">Nein</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="allowances" role="tabpanel" aria-labelledby="allowances-tab">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="JFREIB" class="form-label">Jahresfreibetrag</label>
                                <input type="number" step="0.01" class="form-control" id="JFREIB" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="LZZFREIB" class="form-label">Lohnzahlungszeitraum-Freibetrag</label>
                                <input type="number" step="0.01" class="form-control" id="LZZFREIB" value="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="JHINZU" class="form-label">Jahreshinzurechnungsbetrag</label>
                                <input type="number" step="0.01" class="form-control" id="JHINZU" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="LZZHINZU"
                                    class="form-label">Lohnzahlungszeitraum-Hinzurechnungsbetrag</label>
                                <input type="number" step="0.01" class="form-control" id="LZZHINZU" value="0">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="special-payments" role="tabpanel" aria-labelledby="special-payments-tab">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="SONSTB" class="form-label">Sonstige Bezüge</label>
                                <input type="number" step="0.01" class="form-control" id="SONSTB" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="SONSTENT" class="form-label">In SONSTB enthaltene Entschädigungen</label>
                                <input type="number" step="0.01" class="form-control" id="SONSTENT" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="MBV" class="form-label">Nicht zu besteuernde Vorteile bei
                                    Vermögensbeteiligungen</label>
                                <input type="number" step="0.01" class="form-control" id="MBV" value="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="JRE4" class="form-label">Voraussichtlicher Jahresarbeitslohn</label>
                                <input type="number" step="0.01" class="form-control" id="JRE4" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="JRE4ENT" class="form-label">In JRE4 enthaltene Entschädigungen</label>
                                <input type="number" step="0.01" class="form-control" id="JRE4ENT" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="JVBEZ" class="form-label">In JRE4 enthaltene Versorgungsbezüge</label>
                                <input type="number" step="0.01" class="form-control" id="JVBEZ" value="0">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="pension" role="tabpanel" aria-labelledby="pension-tab">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="VBEZ" class="form-label">In RE4 enthaltene Versorgungsbezüge</label>
                                <input type="number" step="0.01" class="form-control" id="VBEZ" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="VBEZM" class="form-label">Versorgungsbezug im ersten vollen Monat</label>
                                <input type="number" step="0.01" class="form-control" id="VBEZM" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="VBEZS" class="form-label">Voraussichtliche Sonderzahlungen</label>
                                <input type="number" step="0.01" class="form-control" id="VBEZS" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="VBS" class="form-label">In SONSTB enthaltene Versorgungsbezüge</label>
                                <input type="number" step="0.01" class="form-control" id="VBS" value="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="VJAHR" class="form-label">Jahr des Versorgungsbeginns</label>
                                <input type="number" class="form-control" id="VJAHR" value="2025">
                            </div>
                            <div class="mb-3">
                                <label for="ZMVB" class="form-label">Zahl der Monate mit Versorgungsbezug</label>
                                <input type="number" class="form-control" id="ZMVB" value="0">
                            </div>
                            <div class="mb-3">
                                <label for="STERBE" class="form-label">Sterbegeld</label>
                                <input type="number" step="0.01" class="form-control" id="STERBE" value="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="ALTER1">
                        <label class="form-check-label" for="ALTER1">64. Lebensjahr vor dem Kalenderjahr
                            vollendet</label>
                    </div>
                    <div class="mb-3">
                        <label for="AJAHR" class="form-label">Jahr der Vollendung des 64. Lebensjahres</label>
                        <input type="number" class="form-control" id="AJAHR" value="2025">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="f" class="form-label">Faktor (Steuerklasse IV)</label>
                                <input type="number" step="0.001" class="form-control" id="f" value="1.0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="af" class="form-label">Anwendung des Faktorverfahrens</label>
                                <select class="form-select" id="af">
                                    <option value="1" selected>Ja</option>
                                    <option value="0">Nein</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary mt-3">Berechnen</button>
        </form>

        <div id="result" class="mt-5" style="display: none;">
            <h2>Ergebnis</h2>
            <table class="table">
                <tbody>
                    <tr>
                        <th>Lohnsteuer</th>
                        <td id="LSTLZZ"></td>
                    </tr>
                    <tr>
                        <th>Solidaritätszuschlag</th>
                        <td id="SOLZLZZ"></td>
                    </tr>
                    <tr>
                        <th>Kirchensteuer</th>
                        <td id="BK"></td>
                    </tr>
                    <tr>
                        <th>Gesamtbelastung</th>
                        <td id="TOTAL"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="error" class="alert alert-danger mt-3" style="display: none;" role="alert"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Helper function to get number value from input and convert to cents
        function getCentsValue(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.error(`Element with ID '${id}' not found.`);
                return 0; // Return 0 or handle as appropriate
            }
            const value = parseFloat(element.value);
            if (isNaN(value)) {
                return 0;
            }
            return Math.round(value * 100);
        }

        document.getElementById('tax-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const data = {
                RE4: getCentsValue('RE4'),
                STKL: parseInt(document.getElementById('STKL').value),
                LZZ: parseInt(document.getElementById('LZZ').value),
                ZKF: parseFloat(document.getElementById('ZKF').value),
                R: parseInt(document.getElementById('R').value),
                KVZ: parseFloat(document.getElementById('KVZ').value),
                PVS: document.getElementById('PVS').checked ? 1 : 0,
                PVZ: document.getElementById('PVZ').checked ? 1 : 0,
                PKV: parseInt(document.getElementById('PKV').value),
                af: parseInt(document.getElementById('af').value),
                f: parseFloat(document.getElementById('f').value),
                AJAHR: parseInt(document.getElementById('AJAHR').value),
                ALTER1: document.getElementById('ALTER1').checked ? 1 : 0,
                JFREIB: getCentsValue('JFREIB'),
                JHINZU: getCentsValue('JHINZU'),
                JRE4: getCentsValue('JRE4'),
                JRE4ENT: getCentsValue('JRE4ENT'),
                JVBEZ: getCentsValue('JVBEZ'),
                KRV: parseInt(document.getElementById('KRV').value),
                LZZFREIB: getCentsValue('LZZFREIB'),
                LZZHINZU: getCentsValue('LZZHINZU'),
                MBV: getCentsValue('MBV'),
                PKPV: getCentsValue('PKPV'),
                PVA: parseFloat(document.getElementById('PVA').value),
                SONSTB: getCentsValue('SONSTB'),
                SONSTENT: getCentsValue('SONSTENT'),
                STERBE: getCentsValue('STERBE'),
                VBEZ: getCentsValue('VBEZ'),
                VBEZM: getCentsValue('VBEZM'),
                VBEZS: getCentsValue('VBEZS'),
                VBS: getCentsValue('VBS'),
                VJAHR: parseInt(document.getElementById('VJAHR').value),
                ZMVB: parseInt(document.getElementById('ZMVB').value)
            };

            fetch('http://127.0.0.1:8000/api/v1/calculate_payroll_tax', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => { throw err; });
                    }
                    return response.json();
                })
                .then(result => {
                    document.getElementById('LSTLZZ').textContent = (result.LSTLZZ / 100).toFixed(2) + ' €';
                    document.getElementById('SOLZLZZ').textContent = (result.SOLZLZZ / 100).toFixed(2) + ' €';
                    document.getElementById('BK').textContent = (result.BK / 100).toFixed(2) + ' €';

                    // Convert Decimal strings to numbers for calculation
                    const lstlzz = parseFloat(result.LSTLZZ) || 0;
                    const solzlzz = parseFloat(result.SOLZLZZ) || 0;
                    const bk = parseFloat(result.BK) || 0;

                    const total = (lstlzz + solzlzz + bk) / 100;
                    document.getElementById('TOTAL').textContent = total.toFixed(2) + ' €';

                    document.getElementById('result').style.display = 'block';
                    document.getElementById('error').style.display = 'none';
                })
                .catch(error => {
                    const errorDiv = document.getElementById('error');
                    errorDiv.textContent = 'Fehler bei der Berechnung: ' + (error.detail || JSON.stringify(error));
                    errorDiv.style.display = 'block';
                    document.getElementById('result').style.display = 'none';
                });
        });
    </script>
</body>

</html>